<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Halı Yıkama Yönetim Sistemi</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--primary:#1976d2;}
body{background:#f1f6fb;}
.app-header{background:var(--primary);color:white;padding:15px;text-align:center;font-size:20px;font-weight:bold;}
.card{border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
.btn-primary{background:var(--primary);border:none;}
.list-group-item{border-radius:12px;margin-bottom:10px;border:1px solid #e8f0fb;}
</style>
</head>
<body>
<div class="app-header">🧺 Halı Yıkama Yönetim Sistemi</div>
<div class="container my-3">

<ul class="nav nav-tabs" id="myTab">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#ordersTab">📋 Siparişler</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#newOrderTab">➕ Yeni Sipariş</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#oldOrdersTab">📦 Eski Siparişler</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#customersTab">👤 Müşteriler</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#dashboardTab">📊 Dashboard</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#backupTab">💾 Yedekle</button></li>
</ul>

<div class="tab-content">

<!-- Siparişler -->
<div class="tab-pane fade show active p-3" id="ordersTab">
<input id="searchOrder" class="form-control mb-2" placeholder="Adres veya telefon ara">
<div id="ordersList" class="list-group"></div>
</div>

<!-- Yeni Sipariş -->
<div class="tab-pane fade p-3" id="newOrderTab">
<div class="card p-3">
<h5>Yeni Sipariş</h5>
<form id="orderForm">
<input class="form-control mb-2" id="customerName" placeholder="Müşteri Adı" required>
<input class="form-control mb-2" id="customerPhone" placeholder="Telefon" required>
<input class="form-control mb-2" id="customerAddress" placeholder="Adres" required>

<div class="row mb-2">
<div class="col-6">
<label>Halı Türü</label>
<select id="carpetType" class="form-select" required>
<option value="">Seç</option>
<option value="Makine Halısı">Makine Halısı</option>
<option value="Shaggy">Shaggy</option>
<option value="Bambu">Bambu</option>
<option value="İpek">İpek</option>
<option value="El Dokuma">El Dokuma</option>
<option value="Yün">Yün</option>
</select>
</div>
<div class="col-3">
<label>Adet</label>
<input type="number" id="carpetCount" class="form-control" min="1" value="1" required>
</div>
<div class="col-3">
<label>m²</label>
<input type="number" id="carpetSize" class="form-control" min="1" value="1" required>
</div>
</div>

<div class="mb-2">
<label>Peşinat (₺)</label>
<input type="number" id="deposit" class="form-control" value="0">
</div>

<div class="row mb-2">
<div class="col-6">
<label>Alınma Tarihi</label>
<input type="date" id="pickupDate" class="form-control" required>
</div>
<div class="col-6">
<label>Teslim Tarihi</label>
<input type="date" id="deliveryDate" class="form-control">
</div>
</div>

<button class="btn btn-primary w-100">Kaydet</button>
</form>
</div>
</div>

<!-- Eski Siparişler -->
<div class="tab-pane fade p-3" id="oldOrdersTab">
<input id="searchOldOrder" class="form-control mb-2" placeholder="Adres veya telefon ara">
<div id="oldOrdersList" class="list-group"></div>
</div>

<!-- Müşteriler -->
<div class="tab-pane fade p-3" id="customersTab">
<div id="customersList" class="list-group"></div>
</div>

<!-- Dashboard -->
<div class="tab-pane fade p-3" id="dashboardTab">
<div class="row">
<div class="col-md-6"><canvas id="statusChart"></canvas></div>
<div class="col-md-6"><canvas id="incomeChart"></canvas></div>
</div>
</div>

<!-- Yedekleme -->
<div class="tab-pane fade p-3" id="backupTab">
<button class="btn btn-success w-100 mb-2" onclick="downloadJSON()">📥 JSON Olarak İndir</button>
<button class="btn btn-warning w-100" onclick="downloadCSV()">📥 CSV Olarak İndir</button>
</div>

</div></div>

<script>
let orders = JSON.parse(localStorage.getItem("orders")||"[]");
let oldOrders = JSON.parse(localStorage.getItem("oldOrders")||"[]");
let customers = JSON.parse(localStorage.getItem("customers")||"[]");
let prices = {"Makine Halısı":50,"Shaggy":70,"Bambu":90,"İpek":120,"El Dokuma":150,"Yün":100};

function saveData(){localStorage.setItem("orders",JSON.stringify(orders));
localStorage.setItem("oldOrders",JSON.stringify(oldOrders));
localStorage.setItem("customers",JSON.stringify(customers));
renderAll();}

document.getElementById("orderForm").addEventListener("submit",e=>{
e.preventDefault();
let order={
id:Date.now(),
name:customerName.value,
phone:customerPhone.value,
address:customerAddress.value,
type:carpetType.value,
count:+carpetCount.value,
size:+carpetSize.value,
pickup:pickupDate.value,
delivery:deliveryDate.value,
price:prices[carpetType.value]*carpetSize.value*carpetCount.value,
deposit:+deposit.value,
status:"Alındı"
};
orders.push(order);
if(!customers.find(c=>c.phone===order.phone)){customers.push({name:order.name,phone:order.phone,address:order.address});}
saveData();e.target.reset();
});

function renderOrders(){
let q=searchOrder.value.toLowerCase();
ordersList.innerHTML="";
orders.filter(o=>o.address.toLowerCase().includes(q)||o.phone.includes(q))
.forEach(o=>{
let kalan=o.price-o.deposit;
let div=document.createElement("div");
div.className="list-group-item";
div.innerHTML=`<b>${o.name}</b> (${o.phone})<br>
${o.address}<br>
<b>${o.type}</b> x ${o.count} (${o.size} m²) - Toplam: ${o.price}₺<br>
Peşinat: ${o.deposit}₺ | Kalan: ${kalan}₺<br>
Alınma: ${o.pickup} | Teslim: ${o.delivery||"-"}<br>
Durum: ${o.status}
<div class="mt-2">
<button class="btn btn-sm btn-success me-1" onclick="changeStatus(${o.id})">Durum</button>
<button class="btn btn-sm btn-info me-1" onclick="addPayment(${o.id})">💰 Ödeme</button>
<button class="btn btn-sm btn-danger" onclick="deleteOrder(${o.id})">Sil</button>
</div>`;
ordersList.appendChild(div);
});
}

function renderOldOrders(){
let q=searchOldOrder.value.toLowerCase();
oldOrdersList.innerHTML="";
oldOrders.filter(o=>o.address.toLowerCase().includes(q)||o.phone.includes(q))
.forEach(o=>{
oldOrdersList.innerHTML+=`<div class="list-group-item"><b>${o.name}</b> - ${o.phone}<br>${o.type} ${o.size}m² x${o.count} - ${o.price}₺<br>Teslim: ${o.delivery||"-"}</div>`;
});
}

function addPayment(id){
let o=orders.find(x=>x.id===id);
let miktar=+prompt("Ödeme miktarı giriniz:");
if(miktar>0){o.deposit+=miktar;if(o.deposit>=o.price)alert("Tüm ödeme tamamlandı ✅");saveData();}
}

function changeStatus(id){
let o=orders.find(x=>x.id===id);
if(o.status==="Alındı")o.status="Yıkıyor";
else if(o.status==="Yıkıyor")o.status="Teslim Edildi";
else o.status="Alındı";
if(o.status==="Teslim Edildi"){oldOrders.push(o);orders=orders.filter(x=>x.id!==id);}
saveData();
}

function deleteOrder(id){orders=orders.filter(o=>o.id!==id);saveData();}
function renderCustomers(){customersList.innerHTML=customers.map(c=>`<div class="list-group-item"><b>${c.name}</b><br>${c.phone} - ${c.address}</div>`).join("");}

function renderCharts(){
new Chart(document.getElementById("statusChart"),{type:"pie",data:{labels:["Alındı","Yıkıyor","Teslim Edildi"],datasets:[{data:[
orders.filter(o=>o.status==="Alındı").length,
orders.filter(o=>o.status==="Yıkıyor").length,
oldOrders.length],backgroundColor:["#42a5f5","#ffb300","#66bb6a"]}]}});
new Chart(document.getElementById("incomeChart"),{type:"bar",data:{labels:oldOrders.map(o=>o.name),datasets:[{label:"Gelir",data:oldOrders.map(o=>o.price)}]}});
}

function downloadJSON(){let data=JSON.stringify({orders,oldOrders,customers});let a=document.createElement("a");a.href=URL.createObjectURL(new Blob([data],{type:"application/json"}));a.download="yedek.json";a.click();}
function downloadCSV(){let rows=["Ad,Telefon,Adres,Tür,Adet,m2,Fiyat,Peşinat,Durum"];orders.concat(oldOrders).forEach(o=>rows.push(`${o.name},${o.phone},${o.address},${o.type},${o.count},${o.size},${o.price},${o.deposit},${o.status}`));let a=document.createElement("a");a.href=URL.createObjectURL(new Blob([rows.join("\\n")],{type:"text/csv"}));a.download="yedek.csv";a.click();}

function renderAll(){renderOrders();renderOldOrders();renderCustomers();renderCharts();}
searchOrder.addEventListener("input",renderOrders);
searchOldOrder.addEventListener("input",renderOldOrders);
renderAll();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>